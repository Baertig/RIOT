<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Porting boards</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="jquery.scrollTo.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="riot.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <script>
            function displaySR(){
            searchBox.Search();
            var rhtml=(document.getElementById('MSearchResults').contentWindow.document.body.innerHTML).replace(/href=\"\.\.\//g,'href="');
            document.getElementById('MSearchResultsWindow').style.display='none';
            document.getElementById('top').append(document.getElementById('MSearchSelectWindow'));
            document.getElementById('top').append(document.getElementById('MSearchResultsWindow'));
            document.getElementById('doc-content').innerHTML=rhtml;
            }
            function modSearch(){
            if(!searchBox.doxySearch){
                searchBox.doxySearch=searchBox.Search
                searchBox.Search= function(){this.doxySearch();
                var r=document.getElementById('MSearchResultsWindow');console.log(r.style);
                if(parseInt(r.style.left)<0)r.style.left=0;
                var x=document.getElementById('MSearchResults');
                if(x.scrollWidth>window.screen.width)x.style.width=window.screen.width-2+'px';
                var f=document.getElementById('riot-searchform');
                if(parseInt( r.style.top) < f.offsetTop+f.scrollHeight) r.style.top = f.offsetTop+f.scrollHeight+'px';}
            }
            }
        </script>
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="http://riot-os.org"><img height="40px" src="riot-logo.svg" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">The friendly Operating System for the Internet of Things</span></p>
              <ul id="riot-navlist" class="nav navbar-nav"></ul>
              <form id="riot-searchform" class="navbar-form navbar-left navbar-right" action="https://duckduckgo.com/" method="get">
                 <input type="hidden" name="sites" value="doc.riot-os.org"/>
                 <input type="hidden" name="kt" value="h"/>
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" name="q" id="MSearchField" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event); modSearch();">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('porting-boards.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Porting boards </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>At some point you might need to port a new <code>BOARD</code> to <code>RIOT</code>, either because that specific development board is not yet supported or because you have a custom <code>BOARD</code> for your project.</p>
<p>If you want to port a <code>BOARD</code> to <code>RIOT</code> you have two choices: doing it inside of <code>RIOTBASE</code> or outside. In either case the file structure is basically the same and moving from one to another is easy.</p>
<p>This guide details the generic structure you need to add a new <code>BOARD</code> to <code>RIOT</code>, the different files as well as their functionality.</p>
<dl class="section note"><dt>Note</dt><dd>We assume here that your <code>CPU</code> and <code>CPU_MODEL</code> is already supported in <code>RIOT</code> so no peripheral or cpu implementation is needed.</dd></dl>
<h1><a class="anchor" id="porting-flowchart"></a>
Porting flowchart</h1>
<p><div class="dotgraph">
<iframe scrolling="no" frameborder="0" src="dot_porting-boards.svg" width="847" height="802"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</p>
<h1><a class="anchor" id="general-structure"></a>
General structure</h1>
<p>Like <a class="el" href="creating-an-application.html">applications</a> or <a class="el" href="creating-modules.html">modules</a>, boards consist on a directory containing source files and makefiles. Usually a <code>BOARD</code> directory has the following structure</p>
<div class="fragment"><div class="line">board-foo/</div><div class="line">|----dist/</div><div class="line">    |----scripts</div><div class="line">|----board.c</div><div class="line">|----doc.md</div><div class="line">|----include/</div><div class="line">    |----periph_conf.h</div><div class="line">    |----board.h</div><div class="line">    |----gpio_params.h</div><div class="line">|----Makefile</div><div class="line">|----Makefile.dep</div><div class="line">|----Makefile.features</div><div class="line">|----Makefile.include</div></div><!-- fragment --><h2><a class="anchor" id="board-source-files"></a>
Source files</h2>
<p>Header files in <code>board-foo/include</code> define physical mappings or configurations. e.g:</p>
<ul>
<li><code>periph_conf.h</code>: defines configurations and mappings for peripherals as well as clock configurations.</li>
<li><code>board.h</code>: holds board specific definitions or mappings, for example LEDs, buttons. It might as well override default drivers parameters (e.g.: assigning specific pin connections to a LCD screen, radio, etc.). Some boards might also define optimized <code>XTIMER_%</code> values (e.g. <a class="el" href="group__sys__xtimer.html#ga370b9e9a079c4cb4f54fd947b67b9f41">XTIMER_BACKOFF</a>).</li>
<li><code>gpio_params.h</code>: if the board supports <a class="el" href="group__drivers__saul.html">SAUL</a> then its <a class="el" href="structsaul__gpio__params__t.html">saul_gpio_params_t</a> is defined here. (Analogously, a <code>adc_params.h</code> can contain a <a class="el" href="structsaul__adc__params__t.html">saul_adc_params_t</a>, and <code>pwm_params.h</code> a <a class="el" href="structsaul__pwm__rgb__params__t.html">saul_pwm_rgb_params_t</a> and a <a class="el" href="structsaul__pwm__dimmer__params__t.html">saul_pwm_dimmer_params_t</a>).</li>
<li>other: other specific headers needed by one <code>BOARD</code></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Header files do not need to be defined in <code>include/</code>, but if defined somewhere else then they must be added to the include path. In <code>Makefile.include</code>: <code>INCLUDES += -I&lt;some&gt;/&lt;directory&gt;/&lt;path&gt;</code></dd></dl>
<p>Board initialization functions are defined in <code>board.c</code>. This file can define a <code><a class="el" href="group__core__init__config.html#ga916f2adc2080b4fe88034086d107a8dc" title="Initialize board specific hardware. ">board_init()</a></code> function that is called at startup. It is run before the scheduler is started, so it must not block (e.g. by performing I2C operations).</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="group__core__init__config.html#ga916f2adc2080b4fe88034086d107a8dc">board_init</a>(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="comment">/* initialize GPIO or others... */</span></div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md2278"></a>
Makefiles</h2>
<h3><a class="anchor" id="Makefile"></a>
Makefile</h3>
<p>A board's Makefile just needs to include <code>Makefile.base</code> in the RIOT repository and define the <code>MODULE</code> as <code>board</code> (see <a class="el" href="creating-modules.html">modules</a> for more details)</p>
<div class="fragment"><div class="line">MODULE = board</div><div class="line"></div><div class="line">include $(RIOTBASE)/Makefile.base</div></div><!-- fragment --><h3><a class="anchor" id="makefile-dep"></a>
Makefile.dep</h3>
<p>Dependencies on other <code>MODULES</code> or <code>FEATURES</code> can be defined here. This might specify <code>MODULES</code> or dependencies that need to be pulled under specific configurations. e.g.: if your board has a sx1276 lora chip:</p>
<div class="fragment"><div class="line">ifneq (,$(filter netdev_default,$(USEMODULE)))</div><div class="line">  USEMODULE += sx1276</div><div class="line">endif</div></div><!-- fragment --><dl class="section note"><dt>Note</dt><dd><code>Makefile.dep</code> is processed only once so you have to take care of adding the dependency block for your board <em>before</em> its dependencies pull in their own dependencies.</dd></dl>
<h4><a class="anchor" id="autotoc_md2279"></a>
Default configurations</h4>
<p>As explained in <a class="el" href="getting-started.html#default-configurations">Default Configurations</a>, there are two pseudomodules that are used to indicate that certain drivers of devices present in the platform should be enabled. Each board (or CPU) has knowledge as to which drivers should be enabled in each case.</p>
<p>The previous code snippet shows how a board which has a <a class="el" href="group__drivers__sx127x.html">Semtech SX1272 and SX1276 radios driver</a> device, pulls in its driver when the default network interfaces are required.</p>
<p>When the pseudomodule <code>saul_default</code> is enabled, the board should pull in all the drivers of the devices it has which provide a <a class="el" href="group__drivers__saul.html">[S]ensor [A]ctuator [U]ber [L]ayer</a> interface. This is usually done as following:</p>
<div class="fragment"><div class="line">ifneq (,$(filter saul_default,$(USEMODULE)))</div><div class="line">  USEMODULE += saul_gpio</div><div class="line">  USEMODULE += apds9960</div><div class="line">  USEMODULE += bmp280_i2c</div><div class="line">  USEMODULE += lis3mdl</div><div class="line">  USEMODULE += sht3x</div><div class="line">endif</div></div><!-- fragment --><h3><a class="anchor" id="makefile-features"></a>
Makefile.features</h3>
<p>This file defines all the features provided by the BOARD. These features might also need to be supported by the <code>CPU</code>. Here, define the <code>CPU</code> and <code>CPU_MODEL</code> (see <a class="el" href="build-system-basics.html">build system basics</a> for more details on these variables).</p>
<p>e.g.:</p>
<div class="fragment"><div class="line">CPU = foo</div><div class="line">CPU_MODEL = foobar</div><div class="line"></div><div class="line"><span class="comment"># Put defined MCU peripherals here (in alphabetical order)</span></div><div class="line">FEATURES_PROVIDED += periph_i2c</div><div class="line">FEATURES_PROVIDED += periph_spi</div><div class="line">FEATURES_PROVIDED += periph_uart</div></div><!-- fragment --><h3><a class="anchor" id="makefile-include"></a>
Makefile.include</h3>
<p>This file contains BSP or toolchain configurations for the <code>BOARD</code>. It should at least define the configuration needed for flashing (i.e. specify a default programmer) as well as the serial configuration (if one is available). The default serial port configuration is provided by <code>makefiles/tools/serial.inc.mk</code> and define the following values for the serial port (depends on the host OS):</p>
<div class="fragment"><div class="line">PORT_LINUX ?= /dev/ttyACM0</div><div class="line">PORT_DARWIN ?= $(firstword $(sort $(wildcard /dev/tty.usbmodem*)))</div></div><!-- fragment --><p>So if the board is also using this, there's no need to redefine these variables in the board configuration.</p>
<p>For example a board that is using a custom serial port (via an USB to serial adapter) and that is flashed using openocd by default would have the following content in its <code>Makefile.include</code>:</p>
<div class="fragment"><div class="line"><span class="comment"># Define the default port depending on the host OS</span></div><div class="line">PORT_LINUX ?= /dev/ttyUSB0</div><div class="line">PORT_DARWIN ?= $(firstword $(sort $(wildcard /dev/tty.usbserial*)))</div><div class="line"></div><div class="line"><span class="comment"># this board uses openocd</span></div><div class="line">PROGRAMMER ?= openocd</div></div><!-- fragment --><h2><a class="anchor" id="board-timer-configurations"></a>
Timer Configurations</h2>
<p>When using the high level timer <code>ztimer</code> there is an overhead in calling the <a class="el" href="group__sys__ztimer.html#gade98636e198f2d571c8acd861d29d360">ztimer_sleep</a> and <a class="el" href="group__sys__ztimer.html#ga8934a79a89e35d58673418a1e4a2e69c">ztimer_set</a> functions. This offset can be compensated for. It can be measured by running <code>tests/sys/ztimer_overhead</code> on your board, i.e:</p>
<div class="fragment"><div class="line">$ BOARD=my-new-board make -C tests/sys/ztimer_overhead flash term</div><div class="line">main(): This is RIOT!</div><div class="line">ZTIMER_USEC auto_adjust params:</div><div class="line">    ZTIMER_USEC-&gt;adjust_set = xx</div><div class="line">    ZTIMER_USEC-&gt;adjust_sleep = xx</div><div class="line">ZTIMER_USEC auto_adjust params cleared</div><div class="line">zitmer_overhead_set...</div><div class="line">min=6 max=7 avg_diff=6</div><div class="line">zitmer_overhead_sleep...</div><div class="line">min=21 max=21 avg_diff=21</div><div class="line">ZTIMER_USEC adjust params for my-new-board:</div><div class="line">    CONFIG_ZTIMER_USEC_ADJUST_SET    6</div><div class="line">    CONFIG_ZTIMER_USEC_ADJUST_SLEEP  21</div></div><!-- fragment --><p>The last two lines can be added as defines to the new board <code>board.h</code>:</p>
<p>```c /**</p><ul>
<li></li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Wed Mar 12 2025 10:21:28 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.14</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="riot-doxy.js"></script>
  </body>
</html>
