<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" type="image/png" href="favicon.png">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>RPL-over-BLE for NimBLE</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="jquery.min.js"></script>
    <script src="jquery.powertip.min.js"></script>
    <script src="jquery-ui.min.js"></script>
    <script src="jquery.scrollTo.min.js"></script>
    <script src="doxy-jquery.js"></script>
    <script src="dynsections.js"></script>
    <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
    <!-- Bootstrap -->
    <link href="doxygen.css" rel="stylesheet">
    <link href="fonts.css" rel="stylesheet">
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="jquery.smartmenus.bootstrap.css" rel="stylesheet">
    <link href="riot.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
        <script>
            function displaySR(){
            searchBox.Search();
            var rhtml=(document.getElementById('MSearchResults').contentWindow.document.body.innerHTML).replace(/href=\"\.\.\//g,'href="');
            document.getElementById('MSearchResultsWindow').style.display='none';
            document.getElementById('top').append(document.getElementById('MSearchSelectWindow'));
            document.getElementById('top').append(document.getElementById('MSearchResultsWindow'));
            document.getElementById('doc-content').innerHTML=rhtml;
            }
            function modSearch(){
            if(!searchBox.doxySearch){
                searchBox.doxySearch=searchBox.Search
                searchBox.Search= function(){this.doxySearch();
                var r=document.getElementById('MSearchResultsWindow');console.log(r.style);
                if(parseInt(r.style.left)<0)r.style.left=0;
                var x=document.getElementById('MSearchResults');
                if(x.scrollWidth>window.screen.width)x.style.width=window.screen.width-2+'px';
                var f=document.getElementById('riot-searchform');
                if(parseInt( r.style.top) < f.offsetTop+f.scrollHeight) r.style.top = f.offsetTop+f.scrollHeight+'px';}
            }
            }
        </script>
  </head>
  <body>
      <div id="top">
        <nav class="navbar navbar-inverse">
          <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" id="brand-logo" href="http://riot-os.org"><img height="40px" src="riot-logo.svg" /></a>
              <p class="navbar-text text-center visible-xs">Documentation</p>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="navbar-collapse">
              <p class="navbar-text navbar-left"><span id="projectbrief">The friendly Operating System for the Internet of Things</span></p>
              <ul id="riot-navlist" class="nav navbar-nav"></ul>
              <form id="riot-searchform" class="navbar-form navbar-left navbar-right" action="https://duckduckgo.com/" method="get">
                 <input type="hidden" name="sites" value="doc.riot-os.org"/>
                 <input type="hidden" name="kt" value="h"/>
                 <div class="form-group">
                   <div id="MSearchBox" class="MSearchBoxActive">
                     <div class="input-group">
                       <div class="input-group-addon">
                         <span id="MSearchSelect" class="glyphicon glyphicon-search" aria-hidden="true" onmouseover="return searchBox.OnSearchSelectShow()" onmouseout="return searchBox.OnSearchSelectHide()"></span>
                       </div>
                       <input class="form-control" type="text" name="q" id="MSearchField" placeholder="Search" accesskey="S" onfocus="searchBox.OnSearchFieldFocus(true)" onblur="searchBox.OnSearchFieldFocus(false)" onkeyup="searchBox.OnSearchFieldChange(event); modSearch();">
                       <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()">
                         <span id="search-reset" class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                       </a>
                     </div>
                   </div>
                 </div>
              </form>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
        </nav>
      </div>
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__pkg__nimble__rpble.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">RPL-over-BLE for NimBLE<div class="ingroups"><a class="el" href="group__pkg.html">Packages</a><a class="el" href="group__net.html">Networking</a> &raquo;  &#124; <a class="el" href="group__ble.html">Bluetooth Low Energy (BLE)</a> &raquo; <a class="el" href="group__pkg__nimble.html">NimBLE</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>RPL-over-BLE for Nimble implementation.  
<a href="#details">More...</a></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>RPL-over-BLE for Nimble implementation. </p>
<h1><a class="anchor" id="autotoc_md1883"></a>
About</h1>
<p>This module implements a BLE connection manager the manages BLE connections for (multi-hop) IP over BLE networks based on meta data provided by RPL.</p>
<h1><a class="anchor" id="autotoc_md1884"></a>
Concept</h1>
<p>In their initial state, after power up or reboot, nodes start to scan for BLE advertisements containing a specific advertising data (AD) field which holds information about RPL DODAGs. For a configured amount of time, the node ranks all senders of the received advertising packets based on a given metric. After this time, the node selects the best fitting parent based on this ranking and tries to connect to that peer.</p>
<p>After a node has successfully opened a connection to its parent node, the node starts to advertise its own RPL context data to accept connections from potential child nodes.</p>
<p>This approach leads to a BLE network topology that is equal to the IP routing topology created by RPL on top.</p>
<h2><a class="anchor" id="autotoc_md1885"></a>
Advertising data structure</h2>
<p>To include RPL context information into (legacy) BLE advertisements, it must be encoded into the BLE advertising data format. This implementation uses a custom sub-format that is included into the 16-bit UUID Service Data (type: 0x16) field (Supplement to Bluetooth Core Specification CSSv8, 1.11). The 16-bit UUID in this field is set to the IPSS service ID (0x1820).</p>
<p>The following sub-format is used to encode the RPL context data: </p><div class="fragment"><div class="line"><a class="code" href="group__sys__arduino__api.html#gab8ef12fab634c171394422d0ee8baf94">byte</a>     1: instance ID (1b)</div><div class="line"><a class="code" href="group__sys__arduino__api.html#gab8ef12fab634c171394422d0ee8baf94">byte</a>  2-17: DODAG ID (16b)</div><div class="line"><a class="code" href="group__sys__arduino__api.html#gab8ef12fab634c171394422d0ee8baf94">byte</a>    18: DODAG version (1b)</div><div class="line"><a class="code" href="group__sys__arduino__api.html#gab8ef12fab634c171394422d0ee8baf94">byte</a>    19: RPL role (1b)</div><div class="line"><a class="code" href="group__sys__arduino__api.html#gab8ef12fab634c171394422d0ee8baf94">byte</a> 20-21: rank (2b)</div><div class="line"><a class="code" href="group__sys__arduino__api.html#gab8ef12fab634c171394422d0ee8baf94">byte</a>    22: number of <a class="code" href="group__oneway__malloc.html#gafbedc913aa4651b3c3b4b3aecd9b4711">free</a> BLE connection slots (1b)</div></div><!-- fragment --><h2><a class="anchor" id="autotoc_md1886"></a>
Ranking of potential parents</h2>
<p>The currently implemented ranking metric is very simple: the potential parent node with the smallest rank is chosen. Additionally, nodes advertise the number of free BLE connection slots. In case where multiple nodes advertise the same RPL rank, the one with the largest number of open BLE connection slots is selected. The idea behind this is to balance the number of BLE connections per node, and with that also to balance the RPL DODAG.</p>
<h1><a class="anchor" id="autotoc_md1887"></a>
Usage</h1>
<p>To use this module, simply include <code>nimble_rpble</code> into your build. If nothing is explicitly configured, the module will use the default configuration as specified in <code><a class="el" href="nimble__rpble__params_8h.html" title="Default configuration for the nimble_netif_rpble module. ">pkg/nimble/rpble/include/nimble_rpble_params.h</a></code>.</p>
<p>Once a node is configured as RPL root (e.g. using the <code>rpl root ..</code> shell command), it will automatically start to advertise itself. Non-RPL-root nodes will automatically scan for potential parent nodes and join the network as soon as they find fitting neighbors.</p>
<h2><a class="anchor" id="autotoc_md1888"></a>
Implementation status</h2>
<p>In its current state, the implementation only works for environments where a single RPL network with a single DODAG are present. The DODAG ID, instance ID, and DODAG version are currently pretty much ignored when scanning for potential parents. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:nimble__rpble_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nimble__rpble_8h.html">nimble_rpble.h</a></td></tr>
<tr class="memdesc:nimble__rpble_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interface for the nimble_rpble module. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:nimble__rpble__params_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nimble__rpble__params_8h.html">nimble_rpble_params.h</a></td></tr>
<tr class="memdesc:nimble__rpble__params_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default configuration for the nimble_netif_rpble module. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">rpble configuration parameters  <a href="structnimble__rpble__cfg__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnimble__rpble__ctx__t.html">nimble_rpble_ctx_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">RPL DODAG information.  <a href="structnimble__rpble__ctx__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga214c1ef76f1a96dc5a38cdc4f8cdf12e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pkg__nimble__rpble.html#ga214c1ef76f1a96dc5a38cdc4f8cdf12e">nimble_rpble_init</a> (const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *cfg)</td></tr>
<tr class="memdesc:ga214c1ef76f1a96dc5a38cdc4f8cdf12e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the nimble_rpble module with the given parameters.  <a href="#ga214c1ef76f1a96dc5a38cdc4f8cdf12e">More...</a><br /></td></tr>
<tr class="separator:ga214c1ef76f1a96dc5a38cdc4f8cdf12e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab3316c8f8ba5cda852ef938837ee9f07"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pkg__nimble__rpble.html#gab3316c8f8ba5cda852ef938837ee9f07">nimble_rpble_param_update</a> (const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *cfg)</td></tr>
<tr class="memdesc:gab3316c8f8ba5cda852ef938837ee9f07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the used timing parameters.  <a href="#gab3316c8f8ba5cda852ef938837ee9f07">More...</a><br /></td></tr>
<tr class="separator:gab3316c8f8ba5cda852ef938837ee9f07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadc1f0ebd0db249bac732c75178014091"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pkg__nimble__rpble.html#gadc1f0ebd0db249bac732c75178014091">nimble_rpble_eventcb</a> (<a class="el" href="group__pkg__nimble__netif.html#gab1da1302e4fc013bf5c6d65029da922b">nimble_netif_eventcb_t</a> cb)</td></tr>
<tr class="memdesc:gadc1f0ebd0db249bac732c75178014091"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register a callback that is called on BLE events.  <a href="#gadc1f0ebd0db249bac732c75178014091">More...</a><br /></td></tr>
<tr class="separator:gadc1f0ebd0db249bac732c75178014091"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6660af9989321cefe476ac987f84b282"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pkg__nimble__rpble.html#ga6660af9989321cefe476ac987f84b282">nimble_rpble_update</a> (const <a class="el" href="structnimble__rpble__ctx__t.html">nimble_rpble_ctx_t</a> *ctx)</td></tr>
<tr class="memdesc:ga6660af9989321cefe476ac987f84b282"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the current RPL context.  <a href="#ga6660af9989321cefe476ac987f84b282">More...</a><br /></td></tr>
<tr class="separator:ga6660af9989321cefe476ac987f84b282"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="gadc1f0ebd0db249bac732c75178014091"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gadc1f0ebd0db249bac732c75178014091">&#9670;&nbsp;</a></span>nimble_rpble_eventcb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_eventcb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__pkg__nimble__netif.html#gab1da1302e4fc013bf5c6d65029da922b">nimble_netif_eventcb_t</a>&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register a callback that is called on BLE events. </p>
<p>The registered callback function is a simple pass-through of nimble_netif events. The callback is executed in the context of NimBLE's host thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>event callback to register, set to NULL to remove </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga214c1ef76f1a96dc5a38cdc4f8cdf12e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga214c1ef76f1a96dc5a38cdc4f8cdf12e">&#9670;&nbsp;</a></span>nimble_rpble_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_init </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the nimble_rpble module with the given parameters. </p>
<dl class="section note"><dt>Note</dt><dd>This function must be called only once, typically during system initialization</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>configuration parameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd></dl>

</div>
</div>
<a id="gab3316c8f8ba5cda852ef938837ee9f07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab3316c8f8ba5cda852ef938837ee9f07">&#9670;&nbsp;</a></span>nimble_rpble_param_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_param_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnimble__rpble__cfg__t.html">nimble_rpble_cfg_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the used timing parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>configuration parameters</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd></dl>

</div>
</div>
<a id="ga6660af9989321cefe476ac987f84b282"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6660af9989321cefe476ac987f84b282">&#9670;&nbsp;</a></span>nimble_rpble_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nimble_rpble_update </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structnimble__rpble__ctx__t.html">nimble_rpble_ctx_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the current RPL context. </p>
<dl class="section note"><dt>Note</dt><dd>This function is meant to be called only by the RPL implementation</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>current DODAG state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success </dd>
<dd>
-EALREADY if the given context did not change </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
    <div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
        <ul>
            <li class="footer">Generated on Thu Mar 13 2025 10:38:33 by <a href="http://www.doxygen.org/index.html">
                       <img class="footer" src="doxygen.png" alt="doxygen"></a> 1.8.14</li>
        </ul>
    </div>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script src="jquery.smartmenus.min.js"></script>
    <script src="jquery.smartmenus.bootstrap.min.js"></script>
    <script src="riot-doxy.js"></script>
  </body>
</html>
